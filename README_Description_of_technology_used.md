## ✈ 사용 기술 설명

### Back-End

![사용기술-동시성](https://github.com/seomiii/seomiii/assets/86819719/c6475d5c-6edc-4445-acdc-554d6535ec5f)

✅**동시성 처리**

- 트랜잭션 단위의 데이터 정합성 관리를 위해 반짝은행의 모든 입금 및 출금 API에는 분산락 처리가 되어있습니다. 이때, Redis의 Redisson 클라이언트를 활용하여 pub/sub 기능을 통해 합리적으로 Lock 획득 재시도가 가능하도록 하였습니다.
- Redisson을 통해 Lock 획득에 실패할 경우, 특정 채널을 구독하여 Lock이 다시 획득될 수 있는 상태가 되었다는 이벤트를 받았을 때, 다시 Lock 획득을 시도하도록 하였습니다. 그 결과, 불필요한 polling이 일어나지 않도록 하여 효율성을 개선하고, Redis 서버에 부하를 줄였습니다.

![사용기술-부동소수점](https://github.com/seomiii/seomiii/assets/86819719/fa328de9-d7f8-4dfd-aab1-66655095bc34)

✅ **Java 부동 소수점 오차 해결**

- Java의 부동 소수점 오차를 해결하기 위해 반짝은행의 모든 금융거래 계산시, BigDecimal 유틸 클래스의 메소드를 활용하였습니다.
- double보다 범위가 약 2배 이상 길어 좀 더 정밀한 연산이 가능한 BigDecimal을 사용하여 연산시 오차를 줄였습니다.

![사용기술-환율데이터](https://github.com/seomiii/seomiii/assets/86819719/9dae5851-3377-484c-b597-8c36b0fadab1)

✅ **환율 데이터 적용**

- 한국 수출입 은행의 환율 API를 활용했습니다.
- 환율 변동사항이 반영되는 시간대에 맞춰 스케줄러가 동작합니다.
- trip-together가 제공하는 통화들의 환율 정보를 반영합니다.

![사용기술-인증인가](https://github.com/seomiii/seomiii/assets/86819719/d67341c5-040e-415d-a532-58b4e206c2de)

✅ **소셜로그인 (인증/인가)**

- trip-together 로그인 시, 사용자가 은행의 로그인 정보(id,password)와 같은 민감한 정보를 제공하지 않고, 은행이 직접 인증 과정을 처리할 수 있도록 OAuth 2.0을 도입하였습니다.
- Kakao 소셜 로그인의 인증 로직과 동일하게 구현했습니다. 사용자가 은행에 인증 코드를 요청 및 로그인을 진행하고, 발급된 인증 코드를 통해 여행 서비스에서 토큰을 발급받아 로그인이 진행되게 하였습니다.

![사용기술-번개채팅](https://github.com/seomiii/seomiii/assets/86819719/d96468da-a771-4da6-9a5e-95e6db83cb72)

✅ **번개 채팅**

- 트립투게더의 채팅 기능은 웹소켓, STOMP 프로토콜, RabbitMQ 메시지 브로커로 구현되었습니다.
- 첫번째, 웹소켓을 통해 클라이언트와 서버를 연결하여 실시간 양방향 통신이 가능한 환경을 구성하였습니다. 이때, 어떠한 이유로 인해 웹소켓을 사용할 수 없는 경우에 fall option으로 SockJS 프로토콜을 두어 웹소켓 API를 사용하도록 대비하였습니다.
- 두번째, STOMP 프로토콜을 연결하여 pub/sub 구조를 사용할 수 있도록 함으로써, 사용자가 직접 웹소켓 세션에 메시지를 전달하지 않고도 구독한 채널에 발행된 메시지를 브로드캐스트 받을 수 있는 환경을 구성하였습니다.
- 마지막으로, 위의 환경에 외부 메시지 브로커 RabbitMQ를 연결하여 확장성, 결함허용성, 모니터링 가능성을 개선하였습니다.

![사용기술-영수증관리](https://github.com/seomiii/seomiii/assets/86819719/c0d55d27-c433-44cd-9cc1-fac7d362d35f)

✅ **여행 계획 및 정산 영수증 관리**

- 트립투게더의 여행 계획 및 정산 영수증 내역은 MongoDB의 도큐먼트로 관리하여 조회 성능을 향상시켰습니다.
- 일자별 여행 계획과 정산 영수증의 구성요소들은 데이터 정합성이 유지되지 않아도 되는 데이터로 구성되어 있으며, 조회시 테이블 간의 복잡한 연관관계로 다량의 JOIN 쿼리가 발생하도록 되어 있습니다. 따라서 이를 NoSQL 데이터베이스인MongoDB에 도큐먼트로 관리함으로써 기존 RDB에서의 복잡한 JOIN 연산을 간소화하고 조회 성능을 향상시켰습니다.

![사용기술-객체지향](https://github.com/seomiii/seomiii/assets/86819719/1b68c929-86ae-4633-8403-eb9bfc06498a)

✅ **객체지향 설계**

- SRP
   - 도메인 주도 설계 방식 / 핵심 도메인과 도메인 로직에 초점을 맞추고, Entity와 도메인 개념을 일치시켰습니다.
   - 각 도메인은 협력하지만 책임과 역할이 명확히 구분되어 있고, 높은 응집도와 낮은 결합도를 갖추도록 했습니다.
   - 도메인 간 소통 시 발생하는 문제는 Util 클래스와 Facade 패턴을 적용하여 해결했습니다.
- ISP
   - 서비스 로직 설계 시 DB를 조작하는 서비스 로직과 단순 조회 서비스 로직을 인터페이스로 분리하여 설계했습니다.
   - 컨트롤러는 서비스 인터페이스를 호출하여 사용하도록 구현했습니다.
- LSP
   - 정산 과정에서 요청자와 송금자는 모두 정산 참여자인 동시에 다른 역할을 가지고 있습니다.
   - JPA의 단일 테이블 전략을 사용하여 상속 관계를 구현했습니다.
   - 참여자를 추상 엔티티와 추상 레포지토리로 설계하고, 요청자와 송금자가 상속 받도록 했습니다. 이를 통해 DB에는 단일 테이블로 저장하는 동시에 스프링 서버에서는 분리된 코드 작성이 가능하여 개발 과정이 개선되었습니다.

![사용기술-AOP-검증](https://github.com/seomiii/seomiii/assets/86819719/f4368942-3bfb-4269-b7a0-148cecbe4618)

✅ **관심사 분리**

- 검증 로직 어노테이션 관리
   - Auth 도메인에 @PinVerify 등 어노테이션 생성
      - 메서드에 붙을 수 있고, 런타임동안 살아있도록 하였습니다.
   - PinVerifyAspect 클래스 등 생성
      - @Aspect 어노테이션을 통해 AOP 동작을 설정해주었습니다.
      - @PinVerify 어노테이션이 붙은 메서드들에 대해 pinVerifyAdvice 메서드가 먼저 실행 되도록 하였습니다.
      - pinVerifyAdvice 메서드는 해당 요청을 보낸 Member에 대해, 입력된 pin과 실제 값이 같은지를 비교하여, 다르다면 예외를 보내도록 구현하였습니다.

![사용기술-AOP-글로벌예외처리](https://github.com/seomiii/seomiii/assets/86819719/dfc1288f-f977-436e-95ea-589318b869ec)

✅ **글로벌 예외 처리**

- 프로젝트의 모든 에러상황을 스프링이 제공하는 AOP를 통해 관리함으로써, 복잡한 WAS의 에러 전달이 진행되지 않도록 함과 동시에 에러 상황을 세분화한 커스텀 에러 메시지를 사용자에게 전달할 수 있도록 하였습니다.
- 세부적으로, 예외 처리를 위한 ControllerAdvice는 여러 컨트롤러에 대해 전역적으로 ExceptionHandler를 적용하였습니다. 그에 따라 전역적으로 커스텀하게 에러를 핸들링하는 클래스를 만들어 어노테이션을 붙여주면 에러 처리를 위임할 수 있도록 하였습니다.

### Front-End

✅ **Redux를 활용한 상태관리**

- 현재 접속하고 있는 유저에 대한 정보 상태
- 특정 여행지들에 대한 장바구니 상태
- 현재 계획 중인 계획 상태
- 카드 사용 내역 상태
- 네비게이션 탭바 상태를 Redux를 통해 관리함으로써 다양한 컴포넌트에서 상황에 맞게 상태를 업데이트하고 활용 가능하도록 하였습니다.

✅ **디바이스 스토리지 활용**

- Encrypted Storage를 활용해 access token, refresh token 등 보안이 중요한 데이터를 안전하게 관리하였습니다.
- Async Storage를 활용해 채팅 내역, 카드 사용 내역 등의 데이터를 디바이스에서 저장할 수 있도록 하였습니다.

✅ **위치정보, 카메라 활용**

- 앱의 특성을 활용해 권한 허가 이후, 자신의 현재 위치 정보와 카메라 기능을 활용할 수 있도록 했습니다.
- 'native-camera-kit' 라이브러리를 통해 카메라를 활용해 바코드를 인식 후, 결제가 가능하도록 하였습니다.

✅ **번개 채팅**

- WebSocket, Stomp를 이용한 실시간 채팅
- Device Storage를 일종의 캐시로 활용하여 메세지를 저장 및 불러오기 함

✅ **사용자 친화적 UI/UX**

- 안드로이드 스튜디오 디자인 가이드를 참고한 화면 설계
- 사용자가 앱 환경을 이해하고 상호작용하며 제어하는 데 도움이 되는 상호작용 패턴
- Flat Design
